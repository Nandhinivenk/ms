<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Customer Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .food-item, .order-item { border: 1px solid #ccc; padding: 10px; margin: 10px 0; }
        button { margin-top: 10px; }
    </style>
</head>
<body>
<h2>Welcome, <span id="customerName"></span></h2>

<h3>Menu</h3>
<div id="menu"></div>

<h3>Your Orders</h3>
<div id="orders"></div>

<script>
    const token = localStorage.getItem("token");
    const customerId = localStorage.getItem("customerId");
    const customerName = localStorage.getItem("name");
    document.getElementById("customerName").innerText = customerName || "Customer";

    const headers = {
        "Content-Type": "application/json",
        "Authorization": "Bearer " + token
    };

    // Fetch Menu
    fetch("/api/food-items", { headers })
        .then(res => res.json())
        .then(data => {
            const menuDiv = document.getElementById("menu");
            data.forEach(item => {
                const div = document.createElement("div");
                div.className = "food-item";
                div.innerHTML = `
                    <strong>${item.name}</strong> - â‚¹${item.price} <br/>
                    <button onclick="placeOrder(${item.id})">Order</button>
                `;
                menuDiv.appendChild(div);
            });
        });

    // Fetch Orders
    function fetchOrders() {
        fetch(`/orders/customer/${customerId}`, { headers })
            .then(res => res.json())
            .then(data => {
                const ordersDiv = document.getElementById("orders");
                ordersDiv.innerHTML = "";
                data.forEach(order => {
                    const div = document.createElement("div");
                    div.className = "order-item";
                    div.innerHTML = `
                        Order #${order.id} | Item ID: ${order.foodItemId} | Qty: ${order.quantityOrdered} | Status: ${order.orderStatus}
                    `;
                    ordersDiv.appendChild(div);
                });
            });
    }

    fetchOrders();

    function placeOrder(foodItemId) {
        const quantity = prompt("Enter quantity:");
        if (!quantity || isNaN(quantity)) return;

        fetch("/orders", {
            method: "POST",
            headers,
            body: JSON.stringify({
                customerId: customerId,
                foodItemId: foodItemId,
                quantityOrdered: parseInt(quantity),
                orderStatus: "Pending"
            })
        })
        .then(res => res.json())
        .then(() => {
            alert("Order placed successfully!");
            fetchOrders();
        });
    }
</script>
</body>
</html>
